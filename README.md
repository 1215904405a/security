# security
web安全学习总结

# 劫持
DNS劫持：类似使用导航系统时，导航被劫持，给了一条驶向贼窝的路线。

流量劫持：类似写信，信的内容被改过，收信人并不知情。

HTTP：

HTTP不能防DNS劫持，运营商可以把域名解析指向别的服务器，整个网页都换掉。

HTTP不能防流量劫持，内容是不加密的，运营商可以把源站返回的内容加料，比如加些小广告。

HTTPS：

HTTPS并不能防DNS劫持域名解析，假设运营商劫持了域名解析，浏览器由于证书校验不通过，假站点返回的内容也不能正常展示，所以劫持没有收益。只要不随意信任来源不明的证书，就能从功能上防DNS劫持。

HTTPS可以防流量劫持，因为内容是加密的。

## 防御 XSS 及 http劫持，更多的还是得依靠升级 https 和 CSP/CSP2(内容安全策略) 等非 JavaScript 技术，高明的攻击者可以绕过任何 JavaScript 防护。

# xss Cross Site Scripting（跨站脚本）

## XSS的攻击原理

XSS攻击的核心原理是：不需要你做任何的登录认证，它会通过合法的操作（比如在url中输入、在评论框中输入），向你的页面注入脚本（可能是js、hmtl代码块等）。

最后导致的结果可能是：

盗用Cookie破坏页面的正常结构，插入广告等恶意内容D-doss攻击

xss是指黑客往HTML文件中或者DOM中注入恶意脚本，从而再用户浏览页面时利用注入的恶意脚本对用户实施攻击的一种手段。

所有内联 on* 事件执行的代码

a标签 href 属性 javascript: 内嵌的代码

静态脚本、iframe 等恶意内容

动态添加的脚本文件、iframe 等恶意内容

document-write添加的内容

页面被 iframe 嵌套劫持

## XSS的攻击方式

1、反射型

发出请求时，XSS代码出现在url中，作为输入提交到服务器端，服务器端解析后响应，XSS代码随响应内容一起传回给浏览器，最后浏览器解析执行XSS代码。这个过程像一次反射，所以叫反射型XSS。

2、存储型存

储型XSS和反射型XSS的差别在于，提交的代码会存储在服务器端（数据库、内存、文件系统等），下次请求时目标页面时不用再提交XSS代码。

XSS的防范措施（encode + 过滤）

## XSS的防范措施主要有三个：

1、编码：

对用户输入的数据进行

HTML Entity 编码。

如上图所示，把字符转换成 转义字符。

Encode的作用是将

$var

等一些字符进行转化，使得浏览器在最终输出结果上是一样的。

比如说这段代码：

<script>alert(1)</script>

若不进行任何处理，则浏览器会执行alert的js操作，实现XSS注入。

进行编码处理之后，L在浏览器中的显示结果就是

<script>alert(1)</script>

，实现了将$var作为纯文本进行输出，且不引起JavaScript的执行。

2、过滤：

移除用户输入的和事件相关的属性。如onerror可以自动触发攻击，还有onclick等。（总而言是，过滤掉一些不安全的内容）移除用户输入的Style节点、Script节点、Iframe节点。（尤其是Script节点，它可是支持跨域的呀，一定要移除）。

3、校正

避免直接对HTML Entity进行解码。使用DOM Parse转换，校正不配对的DOM标签。备注：我们应该去了解一下

DOM Parse

这个概念，它的作用是把文本解析成DOM结构。

比较常用的做法是，通过第一步的编码转成文本，然后第三步转成DOM对象，然后经过第二步的过滤。

还有一种简洁的答案：

首先是encode，如果是富文本，就白名单。



参考：https://zhuanlan.zhihu.com/p/96826532

# CSRF （Cross-site request forgery），中文名称：跨站请求伪造

CSRF攻击与XSS攻击不同，CSRF攻击不会往页面内注入恶意脚本，因此黑客是无法通过CSRF攻击来获取用户页面数据的，所以主要由服务器来做预防。

主要有以下几种方式：

充分利用好cookie的SameSite属性

SameSite选项通常由Strict、Lax和None三个值

Strict最为严格，如果cookie设置了Strict，那么浏览器会完全禁止第三方Cookie。

Lax相对宽松一点，在跨站点的情况下，从第三方站点的链接打开和从第三方站点提交Get的表单都会携带cookie.但是如果在第三方站点中使用Post方法或者通过img、iframe等标签加载的URL,都不会携带Cookie。

None, 任何情况下都会发送Cookie。

## CSRF如何防御

方法一、Token 验证：（用的最多）

（1）服务器发送给客户端一个token；

（2）客户端提交的表单中带着这个token。

（3）如果这个 token 不合法，那么服务器拒绝这个请求。

方法二：隐藏令牌：

把 token 隐藏在 http 的 head头中。

方法二和方法一有点像，本质上没有太大区别，只是使用方式上有区别。

方法三、Referer 验证：

Referer 指的是页面请求来源。意思是，只接受本站的请求，服务器才做响应；如果不是，就拦截。

参考：https://zhuanlan.zhihu.com/p/98062456


## CSRF 和 XSS 的区别

区别一：

CSRF：需要用户先登录网站A，获取 cookie。XSS：不需要登录。

区别二：（原理的区别）

CSRF：是利用网站A本身的漏洞，去请求网站A的api。XSS：是向网站 A 注入 JS代码，然后执行 JS 里的代码，篡改网站A的内容。
